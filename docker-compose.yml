version: "3.4"

x-cache-from:
  - &api-cache-from
    cache_from:
      - ${NGINX_IMAGE:-quay.io/api-platform/nginx}
      - ${PHP_IMAGE:-quay.io/api-platform/php}

services:

  # api:
  #   build:
  #     context: ./
  #     target: api_platform_nginx
  #     <<: *api-cache-from
  #   image: ${NGINX_IMAGE:-quay.io/api-platform/nginx}
  #   depends_on:
  #     - php
  #   volumes:
  #     - ./public:/srv/api/public:ro

  # database:
  #   image: postgres:12-alpine
  #   environment:
  #     POSTGRES_DB: projet_vma
  #     POSTGRES_USER: root
  #     POSTGRES_PASSWORD: root
  #   ports:
  #     - 5432:5432

  db:
    image: postgres:13-alpine
    environment:
      - POSTGRES_DB=projet_vma
      - POSTGRES_PASSWORD=root
      - POSTGRES_USER=api-root
    volumes:
      - db-data:/var/lib/postgresql/data:rw
      # you may use a bind-mounted host directory instead, so that it is harder to accidentally remove the volume and lose all your data!
      # - ./api/docker/db/data:/var/lib/postgresql/data:rw
    ports:
      - target: 5432
        published: 5432
        protocol: tcp
  
  # dev-tls:
  #   build:
  #     context: ./docker/dev-tls
  #   volumes:
  #     - dev-certs:/certs:rw
  #   ports:
  #     - target: 80
  #       published: 80
  #       protocol: tcp

volumes:
  db-data: {}
  dev-certs: {}
  